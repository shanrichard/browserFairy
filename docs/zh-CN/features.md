# 功能特性

## 核心能力

### 🧠 内存监控

**实时内存追踪**
- JS堆使用量和趋势
- DOM节点数量统计
- 文档和帧数监控

**事件监听器泄漏检测** ⭐
- 自动检测异常增长（>20个）
- 精确定位泄漏源文件和行号
- 识别高风险函数（绑定>10个元素）
- 分析事件类型分布

示例输出：
```
⚠️ 发现监听器泄漏：
ProductList.jsx:156 - handleProductClick
绑定了15个元素但从未清理
```

### 🌐 网络分析

**HTTP请求监控**
- 请求/响应生命周期
- 大文件传输警告（>1MB）
- 请求耗时统计
- 失败请求追踪

**JavaScript调用栈追踪** ⭐
智能触发条件：
- 大上传（>100KB）
- 大下载（>100KB）
- 高频API（>10次）
- 重复资源（>3次）

精确定位请求发起者：
```
大请求：api.example.com/export.json (5.2MB)
调用链：Dashboard.fetchData() → app.js:89
```

**WebSocket实时监控** ⭐
- 连接生命周期管理
- 消息帧频率统计
- 文本/二进制消息区分
- 消息风暴检测（>50帧/秒）

### ⚠️ 错误追踪

**Console监控**
- JavaScript错误捕获
- 警告和日志分级
- 错误堆栈追踪
- 源文件定位

**Source Map解析** ⭐ 🆕
- 自动检测JavaScript Source Map
- 将压缩代码错误映射到源代码
- 恢复原始函数名和文件路径
- 支持data URL和HTTP Source Map

示例对比：
```
未启用Source Map：
错误位置：bundle.min.js:1:45678
函数名：a

启用Source Map后：
错误位置：src/components/Form.jsx:42:15
函数名：handleSubmit
```

**异常检测**
- 未捕获异常
- Promise拒绝
- 语法错误
- 运行时错误

### ⚡ 性能诊断

**长任务检测** ⭐
- 捕获>50ms的JavaScript执行
- 完整调用栈信息
- 第三方代码识别（iframe等）
- 主线程阻塞分析

示例：
```
长任务：156ms阻塞
函数：processLargeDataset
文件：processor.js:234
影响：页面无响应156ms
```

**垃圾回收监控**
- GC事件检测
- 内存释放量统计
- Major/Minor GC区分
- GC频率分析

**内存采样分析** ⭐
- HeapProfiler轻量级采样
- 函数级内存分配统计
- 热点函数精确定位
- 调用栈信息收集

示例：
```
内存分配热点：
ProductList.processData() - app.js:234
分配了15.2MB内存 (52.3%比例)
156次采样 - 平均每次98KB
```

**布局性能**
- 布局次数和耗时
- 样式重计算统计
- 脚本执行时间
- 渲染性能指标

### 💾 存储监控

**配额监控**
- 浏览器存储配额
- 使用量百分比
- 超限警告

**DOMStorage事件**
- localStorage变更追踪
- sessionStorage监控
- 键值对增删改事件

**存储快照** ⭐
- 完整localStorage/sessionStorage导出
- 敏感数据截断保护
- 按网站过滤
- 调试状态快速诊断

### 🔗 智能关联

**时间窗口关联**
- 15秒窗口事件聚合
- 跨指标模式识别
- 因果关系推断
- 自动问题诊断

示例关联：
```
检测到模式：大数据处理问题
1. 5MB API响应
2. 内存增加50MB
3. 出现栈溢出错误
可能原因：数据处理算法效率问题
```

## 技术特性

### 架构优势

**无侵入监控**
- 基于Chrome DevTools Protocol
- 无需修改代码
- 不影响应用运行
- 零配置部署

**Target级隔离**
- 每个标签页独立会话
- 精确数据分离
- 避免混淆污染
- 支持50+标签页并发

**异步事件驱动**
- 非阻塞数据收集
- 队列缓冲机制
- 背压自动调节
- 优雅降级策略

### 性能优化

**资源控制**
- CPU占用<2%
- 内存占用<50MB
- 全局并发限制（8个）
- 智能采样策略

**数据优化**
- JSONL流式存储
- 自动文件轮转
- 事件去重机制
- 可配置输出过滤
- 支持12种数据类型（memory, console, network, gc, heap_sampling等）

**频率限制**
- Console事件≤10/秒
- Network事件≤50/秒
- 长任务≤20/秒
- 队列满时自动丢弃

### 部署特性

**一键启动**
- 自动Chrome实例管理
- 独立浏览器环境
- 生命周期自动绑定
- 崩溃自动恢复

**灵活部署**
- 前台/后台模式
- Docker容器支持
- CI/CD集成友好
- 跨平台兼容

**数据管理**
- 按会话组织
- 按网站分类
- 自定义输出目录
- 环境变量配置

## AI集成特性

### 数据AI友好

**结构化输出**
- 标准JSON格式
- 清晰字段命名
- 完整上下文信息
- 事件时序保证

**智能过滤**
- errors-only模式
- ai-debug预设
- 自定义组合
- 噪声自动过滤

**辅助分析**
- 事件ID去重
- 关联分析结果
- 模式识别提示
- 问题根因推断

### 集成便利

**项目内运行**
- 数据保存到项目目录
- 相对路径支持
- .gitignore友好
- 零配置集成

**实时可见**
- 流式数据写入
- 即时可读
- 增量更新
- 无需等待

## 独特优势

### 对比Chrome DevTools

| 特性 | Chrome DevTools | BrowserFairy |
|------|----------------|--------------|
| 自动化 | ❌ 手动操作 | ✅ 全自动 |
| 历史数据 | ❌ 仅当前 | ✅ 完整历史 |
| AI可读 | ❌ 不支持 | ✅ 原生支持 |
| 多标签页 | ❌ 单个 | ✅ 全部 |
| 后台运行 | ❌ 需打开 | ✅ 支持 |

### 对比传统APM

| 特性 | 传统APM | BrowserFairy |
|------|---------|--------------|
| 部署成本 | 需要集成SDK | 零代码 |
| 浏览器深度 | 有限 | 完整 |
| 实时性 | 延迟上报 | 实时 |
| 数据所有权 | 云端 | 本地 |
| AI集成 | 需要API | 直接读取 |

## 适用场景

### 开发阶段
- 本地调试
- 性能优化
- 内存泄漏排查
- API调试

### 测试阶段
- E2E测试监控
- 性能基准测试
- 回归测试
- 压力测试

### 生产环境
- 问题诊断
- 用户行为分析
- 性能监控
- 故障排查

### AI协作
- Claude Code调试
- Cursor集成
- Copilot辅助
- 自动化分析

## 路线图

### 已完成 ✅
- 核心监控功能
- AI友好输出
- 一键部署
- HeapProfiler内存采样分析
- 163个测试用例（含15个HeapSampling测试）

### 计划中 📋
- 更多AI工具集成
- 可视化界面
- 企业版功能