# Task 2-1 - 小幅事件和I/O优化

## Status: COMPLETED ✅

## Subtasks
- [x] 2-1-1 TabMonitor事件卸载修复 - 传递handler参数给off_event调用
- [x] 2-1-2 DataWriter延迟同步功能 - 添加enable_delayed_sync参数和线程安全实现  
- [x] 2-1-3 轮转前数据安全 - 无条件fsync确保重命名文件数据完整性
- [x] 2-1-4 DataManager集成 - 会话结束时调用force_sync_pending确保数据落盘
- [x] 2-1-5 测试验证 - 所有119个测试通过，无功能回归

## 完成总结

### 修复内容
1. **TabMonitor事件卸载修复**：修复3行代码，正确传递handler参数，避免误删其他组件的事件处理器
2. **DataWriter延迟同步**：添加可选的延迟fsync功能，线程安全设计，轮转前强制同步
3. **数据安全保证**：会话结束时批量同步，确保延迟模式下数据完整性

### 技术亮点
- **最小影响原则**：默认行为完全不变，向下兼容
- **线程安全**：`_pending_sync_files`只在事件循环线程操作
- **数据完整性**：轮转前无条件fsync + 会话结束强制同步
- **函数一致性**：复用现有`_sync_rotate_files`，不影响现有测试

### 验证结果
- ✅ 全部119个测试通过
- ✅ 无功能回归
- ✅ 架构风险修复
- ✅ 性能优化选项可用